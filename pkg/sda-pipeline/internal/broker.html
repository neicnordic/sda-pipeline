<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#375EAB">
  <title>NeIC sda-pipeline - go documentation</title>
  <link type="text/css" rel="stylesheet" href="../../../lib/godoc/style.css">
  
  <script>window.initFuncs = [];</script>
  <script src="../../../lib/godoc/jquery.js" defer></script>
  

  
  
  <script>var goVersion = "go1.17.11";</script>
  <script src="../../../lib/godoc/godocs.js" defer></script>
</head>

<body>

  <div id='lowframe'
    style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
    ...
  </div><!-- #lowframe -->

  <div id="topbar"  class="wide" >
    <div class="container">
      <div class="top-heading" id="heading-wide"><a
          href="https://neicnordic.github.io/sda-pipeline/pkg/sda-pipeline/">Go Documentation Server</a></div>
      <div class="top-heading" id="heading-narrow"><a
          href="https://neicnordic.github.io/sda-pipeline/pkg/sda-pipeline/">GoDoc</a></div>
      <a href="broker.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>


    </div>
  </div>

  <div class="container" style="padding: 1em">
    Please see <a href="https://github.com/neicnordic/sda-pipeline/">https://github.com/neicnordic/sda-pipeline/</a> for
    the code
    repository.
  </div>

  <div id="page"  class="wide" >
    <div class="container">

      
      <h1>
        Package broker
        <span class="text-muted"></span>
      </h1>
      

      

      

      
          <div id="nav"></div>

          
          <!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "sda-pipeline/internal/broker"</code></dd>
			</dl>
			<dl>
			<dd><a href="broker.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="broker.html#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
Package broker contains logic for communicating with a message broker
</p>

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
				
				<dd><a href="broker.html#TLSConfigBroker">func TLSConfigBroker(config MQConf) (*tls.Config, error)</a></dd>
			
			
				
				<dd><a href="broker.html#AMQPBroker">type AMQPBroker</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="broker.html#NewMQ">func NewMQ(config MQConf) (*AMQPBroker, error)</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="broker.html#AMQPBroker.ConnectionWatcher">func (broker *AMQPBroker) ConnectionWatcher() *amqp.Error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="broker.html#AMQPBroker.GetMessages">func (broker *AMQPBroker) GetMessages(queue string) (&lt;-chan amqp.Delivery, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="broker.html#AMQPBroker.SendJSONError">func (broker *AMQPBroker) SendJSONError(delivered *amqp.Delivery, originalBody []byte, conf MQConf, reason, errorMsg string) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="broker.html#AMQPBroker.SendMessage">func (broker *AMQPBroker) SendMessage(corrID, exchange, routingKey string, reliable bool, body []byte) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="broker.html#AMQPBroker.ValidateJSON">func (broker *AMQPBroker) ValidateJSON(delivered *amqp.Delivery, messageType string, body []byte, dest interface{}) error</a></dd>
				
			
				
				<dd><a href="broker.html#AMQPChannel">type AMQPChannel</a></dd>
				
				
			
				
				<dd><a href="broker.html#InfoError">type InfoError</a></dd>
				
				
			
				
				<dd><a href="broker.html#MQConf">type MQConf</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go.html">broker.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
			
			
			<h2 id="TLSConfigBroker">func <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L167">TLSConfigBroker</a>
				<a class="permalink" href="broker.html#TLSConfigBroker">&#xb6;</a>
				
				
			</h2>
			<pre>func TLSConfigBroker(config <a href="broker.html#MQConf">MQConf</a>) (*<a href="https://pkg.go.dev/crypto/tls/">tls</a>.<a href="https://pkg.go.dev/crypto/tls/#Config">Config</a>, <a href="https://pkg.go.dev/builtin/#error">error</a>)</pre>
			<p>
TLSConfigBroker is a helper method to setup TLS for the message broker
</p>

			
			

		
		
			
			
			<h2 id="AMQPBroker">type <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L21">AMQPBroker</a>
				<a class="permalink" href="broker.html#AMQPBroker">&#xb6;</a>
				
				
			</h2>
			<p>
AMQPBroker is a Broker that reads messages from an AMQP broker
</p>

			<pre>type AMQPBroker struct {
<span id="AMQPBroker.Connection"></span>    Connection *<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Connection">Connection</a>
<span id="AMQPBroker.Channel"></span>    Channel    <a href="broker.html#AMQPChannel">AMQPChannel</a>
<span id="AMQPBroker.Conf"></span>    Conf       <a href="broker.html#MQConf">MQConf</a>
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewMQ">func <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L61">NewMQ</a>
					<a class="permalink" href="broker.html#NewMQ">&#xb6;</a>
					
					
				</h3>
				<pre>func NewMQ(config <a href="broker.html#MQConf">MQConf</a>) (*<a href="broker.html#AMQPBroker">AMQPBroker</a>, <a href="https://pkg.go.dev/builtin/#error">error</a>)</pre>
				<p>
NewMQ creates a new Broker that can communicate with a backend
amqp server.
</p>

				
				
			

			
				
				<h3 id="AMQPBroker.ConnectionWatcher">func (*AMQPBroker) <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L225">ConnectionWatcher</a>
					<a class="permalink" href="broker.html#AMQPBroker.ConnectionWatcher">&#xb6;</a>
					
					
				</h3>
				<pre>func (broker *<a href="broker.html#AMQPBroker">AMQPBroker</a>) ConnectionWatcher() *<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Error">Error</a></pre>
				<p>
ConnectionWatcher listens to events from the server
</p>

				
				
				
			
				
				<h3 id="AMQPBroker.GetMessages">func (*AMQPBroker) <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L112">GetMessages</a>
					<a class="permalink" href="broker.html#AMQPBroker.GetMessages">&#xb6;</a>
					
					
				</h3>
				<pre>func (broker *<a href="broker.html#AMQPBroker">AMQPBroker</a>) GetMessages(queue <a href="https://pkg.go.dev/builtin/#string">string</a>) (&lt;-chan <a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Delivery">Delivery</a>, <a href="https://pkg.go.dev/builtin/#error">error</a>)</pre>
				<p>
GetMessages reads messages from the queue
</p>

				
				
				
			
				
				<h3 id="AMQPBroker.SendJSONError">func (*AMQPBroker) <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L231">SendJSONError</a>
					<a class="permalink" href="broker.html#AMQPBroker.SendJSONError">&#xb6;</a>
					
					
				</h3>
				<pre>func (broker *<a href="broker.html#AMQPBroker">AMQPBroker</a>) SendJSONError(delivered *<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Delivery">Delivery</a>, originalBody []<a href="https://pkg.go.dev/builtin/#byte">byte</a>, conf <a href="broker.html#MQConf">MQConf</a>, reason, errorMsg <a href="https://pkg.go.dev/builtin/#string">string</a>) <a href="https://pkg.go.dev/builtin/#error">error</a></pre>
				<p>
SendJSONError sends message on JSON error
</p>

				
				
				
			
				
				<h3 id="AMQPBroker.SendMessage">func (*AMQPBroker) <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L126">SendMessage</a>
					<a class="permalink" href="broker.html#AMQPBroker.SendMessage">&#xb6;</a>
					
					
				</h3>
				<pre>func (broker *<a href="broker.html#AMQPBroker">AMQPBroker</a>) SendMessage(corrID, exchange, routingKey <a href="https://pkg.go.dev/builtin/#string">string</a>, reliable <a href="https://pkg.go.dev/builtin/#bool">bool</a>, body []<a href="https://pkg.go.dev/builtin/#byte">byte</a>) <a href="https://pkg.go.dev/builtin/#error">error</a></pre>
				<p>
SendMessage sends a message to RabbitMQ
</p>

				
				
				
			
				
				<h3 id="AMQPBroker.ValidateJSON">func (*AMQPBroker) <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L247">ValidateJSON</a>
					<a class="permalink" href="broker.html#AMQPBroker.ValidateJSON">&#xb6;</a>
					
					
				</h3>
				<pre>func (broker *<a href="broker.html#AMQPBroker">AMQPBroker</a>) ValidateJSON(delivered *<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Delivery">Delivery</a>,
    messageType <a href="https://pkg.go.dev/builtin/#string">string</a>,
    body []<a href="https://pkg.go.dev/builtin/#byte">byte</a>,
    dest interface{}) <a href="https://pkg.go.dev/builtin/#error">error</a></pre>
				<p>
ValidateJSON validates JSON in body, verifying that it&#39;s valid JSON as well
as conforming to the schema specified by messageType. It also optionally
verifies that the message can be decoded into the supplied data structure dest
</p>

				
				
				
			
		
			
			
			<h2 id="AMQPChannel">type <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L12">AMQPChannel</a>
				<a class="permalink" href="broker.html#AMQPChannel">&#xb6;</a>
				
				
			</h2>
			<p>
The AMQPChannel interface gives access to the functions provided
</p>

			<pre>type AMQPChannel interface {
    Consume(queue, consumer <a href="https://pkg.go.dev/builtin/#string">string</a>, autoAck, exclusive, noLocal, noWait <a href="https://pkg.go.dev/builtin/#bool">bool</a>, args <a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Table">Table</a>) (&lt;-chan <a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Delivery">Delivery</a>, <a href="https://pkg.go.dev/builtin/#error">error</a>)
    Confirm(noWait <a href="https://pkg.go.dev/builtin/#bool">bool</a>) <a href="https://pkg.go.dev/builtin/#error">error</a>
    NotifyPublish(confirm chan <a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Confirmation">Confirmation</a>) chan <a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Confirmation">Confirmation</a>
    Publish(exchange, key <a href="https://pkg.go.dev/builtin/#string">string</a>, mandatory, immediate <a href="https://pkg.go.dev/builtin/#bool">bool</a>, msg <a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/">amqp</a>.<a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go/#Publishing">Publishing</a>) <a href="https://pkg.go.dev/builtin/#error">error</a>
    Close() <a href="https://pkg.go.dev/builtin/#error">error</a>
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="InfoError">type <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L53">InfoError</a>
				<a class="permalink" href="broker.html#InfoError">&#xb6;</a>
				
				
			</h2>
			<p>
InfoError struct for sending detailed error messages to analysis.
The empty interface allows for appending various json msgs but also broken json msgs as strings.
It is ok as long as we do not need to access fields in the msg, which we don&#39;t.
</p>

			<pre>type InfoError struct {
<span id="InfoError.Error"></span>    Error           <a href="https://pkg.go.dev/builtin/#string">string</a>      `json:&#34;error&#34;`
<span id="InfoError.Reason"></span>    Reason          <a href="https://pkg.go.dev/builtin/#string">string</a>      `json:&#34;reason&#34;`
<span id="InfoError.OriginalMessage"></span>    OriginalMessage interface{} `json:&#34;original-message&#34;`
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="MQConf">type <a href="https://github.com/neicnordic/sda-pipeline/tree/master/internal/broker/broker.go#L29">MQConf</a>
				<a class="permalink" href="broker.html#MQConf">&#xb6;</a>
				
				
			</h2>
			<p>
MQConf stores information about the message broker
</p>

			<pre>type MQConf struct {
<span id="MQConf.Host"></span>    Host               <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.Port"></span>    Port               <a href="https://pkg.go.dev/builtin/#int">int</a>
<span id="MQConf.User"></span>    User               <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.Password"></span>    Password           <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.Vhost"></span>    Vhost              <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.Queue"></span>    Queue              <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.Exchange"></span>    Exchange           <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.RoutingKey"></span>    RoutingKey         <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.RoutingError"></span>    RoutingError       <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.Ssl"></span>    Ssl                <a href="https://pkg.go.dev/builtin/#bool">bool</a>
<span id="MQConf.InsecureSkipVerify"></span>    InsecureSkipVerify <a href="https://pkg.go.dev/builtin/#bool">bool</a>
<span id="MQConf.VerifyPeer"></span>    VerifyPeer         <a href="https://pkg.go.dev/builtin/#bool">bool</a>
<span id="MQConf.CACert"></span>    CACert             <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.ClientCert"></span>    ClientCert         <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.ClientKey"></span>    ClientKey          <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.ServerName"></span>    ServerName         <a href="https://pkg.go.dev/builtin/#string">string</a>
<span id="MQConf.Durable"></span>    Durable            <a href="https://pkg.go.dev/builtin/#bool">bool</a>
<span id="MQConf.SchemasPath"></span>    SchemasPath        <a href="https://pkg.go.dev/builtin/#string">string</a>
}
</pre>

			

			

			
			
			

			

			
		
	

	







          <div id="footer">
            Build version go1.17.11.<br>
            Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
            the content of this page is licensed under the
            Creative Commons Attribution 3.0 License,
            and code is licensed under a <a
              href="https://github.com/neicnordic/sda-pipeline/blob/master/LICENSE">AGPL-3.0
              License</a>.<br>
            The documentation is hosted by Github.
            <a href="https://www.google.com/intl/en/policies/terms/">Google Terms of Service</a> |
            <a href="http://www.google.com/intl/en/policies/privacy/">Google Privacy Policy</a> |
            <a href="https://docs.github.com/en/github/site-policy/github-terms-of-service">Github Terms of Service</a>
            |
            <a href="https://docs.github.com/en/github/site-policy/github-privacy-statement">Github Privacy Policy</a>
          </div>

        </div><!-- .container -->
      </div><!-- #page -->
</body>

</html>